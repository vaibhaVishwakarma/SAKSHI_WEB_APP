<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Camera Feed at 2 FPS</title>
    <style>
        video {
            display: none; /* Hide the video element */
        }
        canvas {
            width: 100%; /* Adjust as needed */
            height: auto; /* Maintain aspect ratio */
            border: 1px solid black; /* Optional: for visibility */
        }
    </style>
</head>
<body>
    <h1>Camera Feed at 2 FPS</h1>
    <canvas id="canvas"></canvas>
    <video id="video" autoplay playsinline></video>

    <script>
        async function startCamera() {
            const video = document.getElementById('video');
            const canvas = document.getElementById('canvas');
            const context = canvas.getContext('2d');

            try {
                // Request access to the user's camera
                const stream = await navigator.mediaDevices.getUserMedia({ video: true });
                video.srcObject = stream;

                // Set the canvas size to match the video
                video.addEventListener('loadedmetadata', () => {
                    canvas.width = video.videoWidth;
                    canvas.height = video.videoHeight;
                });

                // Capture frames at 2 FPS
                setInterval(async () => {
                    // Draw the current video frame to the canvas
                    context.drawImage(video, 0, 0, canvas.width, canvas.height);

                    // Convert the canvas to a Blob
                    canvas.toBlob(async (blob) => {
                        if (blob) {
                            // Create a FormData object to send the blob
                            const formData = new FormData();
                            formData.append('file', blob, 'frame.jpg');

                            // Send the blob to the server
                            try {
                                const response = await fetch('/uploadfile/', {
                                    method: 'POST',
                                    body: formData,
                                });

                                if (!response.ok) {
                                    throw new Error('Network response was not ok');
                                }

                                const result = await response.json();
                                console.log('File uploaded successfully:', result);
                            } catch (error) {
                                console.error('Error uploading file:', error);
                            }
                        }
                    }, 'image/jpeg'); // Specify the image format
                }, 1000 / 1); // 1000 ms / 2 FPS = 500 ms per frame
            } catch (error) {
                console.error('Error accessing the camera:', error);
            }
        }

        // Start the camera when the page loads
        window.onload = startCamera;
    </script>
</body>
</html>
